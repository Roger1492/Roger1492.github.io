<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Day 037 - 粒子效果</title>
</head>

<body>
  <canvas id="myCanvas" width="800" height="700" style="background-color: #00bfff;"></canvas>


  <script>

    // 初始化
    var args = {
      point_num: 50,
      speed: 0.5,
      connect_dist: 0.1,
      color: "#FFFFF0"
    };
    var c = document.getElementById("myCanvas");
    var points = new Array(args.point_num);
    
    // 生成粒子
    for(let i = 0; i < points.length; i++){
      points[s] = {
        x: Math.floor(Math.random() * c.width),
        y: Math.floor(Math.random() * c.height),
        move: Math.random() * 2 * Math.PI
      };
    }

    // 处理窗口缩放
    function resizeCanvas(){
      for(let i = 0; i < points.length; i++){
        let p = points[i];
        p.x = (p.x / c.width) * document.body.clientWidth;
        p.y = (p.y / c.height) * document.body.clientHeight;
      }
      c.width = document.body.clientWidth;
      c.height = document.body.clientHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas, false);

    // 粒子移动
    function pointsMove(ps){
      for(let i = 0; i < ps.length; i++){
        let p = ps[i];

        p.x += args.speed * Math.sin(p.move);
        p.y += args.speed * Math.cos(p.move);

        if(p.x < 0 || p.x > c.width){
          p.move = 2 * Math.PI - p.move;
        } else if(p.y > c.height || p.y < 0){
          p.move = Math.PI - p.move;
        }
      }
    }

    // 显示逻辑
    function show(){
      points.sort((a,b) => (a.x - b.x));

      let ctx = c.getContext('2d');
      ctx.fillRect(0, 0, c.width, c.height);
      ctx.fillStyle = args.color;
      ctx.strokeStyle = args.color;
      let d_connect = Math.max(c.width, c.height) * args.connect_dist;
    }
    show();
  </script>
</body>

</html>