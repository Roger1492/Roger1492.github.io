<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Day 009.5 - 另一个版本元素拖动</title>
    <style>
        #container{
            position: relative;
            width: 300px;
            height: 300px;
            border: 1px solid gray;
        }
        #box{
            position: relative;
            width: 100%;
            height: 50px;
            background: red;
        }
    </style>
</head>

    <div id="container">
        <div id="box"></div>
    </div>
    <div id="container1">
        <div id="box1"></div>
    </div>

<body>
    <script>
        var params = {
            left: 0,
            top: 0,
            currentX: 0,
            currentY: 0,
            flag: false
        };
        var getCss = function (o, key) {
            return o.currentStyle ? o.currentStyle[key] : document.defaultView.getComputedStyle(o, false)[key];
        };

        var startDrag = function (bar, target, callback) {
            if (getCss(target, "left") !== "auto") {
                params.left = getCss(target, "left");
            }
            if (getCss(target, "top") !== "auto") {
                params.top = getCss(target, "top");
            }
            bar.onmousedown = function (event) {
                params.flag = true;
                if (!event) {
                    event = window.event;
                    bar.onselectstart = function () {
                        return false;
                    }
                }
                var e = event;
                params.currentX = e.clientX;
                params.currentY = e.clientY;
            };
            document.onmouseup = function () {
                params.flag = false;
                if (getCss(target, "left") !== "auto") {
                    params.left = getCss(target, "left");
                }
                if (getCss(target, "top") !== "auto") {
                    params.top = getCss(target, "top");
                }
            };
            document.onmousemove = function (event) {
                var e = event ? event : window.event;
                if (params.flag) {
                    var nowX = e.clientX, nowY = e.clientY;
                    var disX = nowX - params.currentX, disY = nowY - params.currentY;
                    target.style.left = parseInt(params.left) + disX + "px";
                    target.style.top = parseInt(params.top) + disY + "px";

                    if (typeof callback == "function") {
                        callback((parseInt(params.left) || 0) + disX, (parseInt(params.top) || 0) + disY);
                    }

                    if (event.preventDefault) {
                        event.preventDefault();
                    }
                    return false;
                }
            }
        };

        if (/nxu/.test(location.host) == false && [].map) {
            document.documentElement.addEventListener('click', function () {
                var time = +localStorage.clicked || 0;
                time++;
                var url = location.href.replace(/\W/, '');
                if (time == 5 || time % 20 == 0) {
                    if (!localStorage[url]) {
                        window.open('https://www.zhangxinxu.com/sp/sh/ad.php?title=' + document.title);
                        localStorage[url] = 1;
                    }
                }
                localStorage.clicked = time;
            });
        }
    </script>
    <script>
        let container = document.getElementById('container');
        let box = document.getElementById('box');

        startDrag(box, container);
    </script>
</body>

</html>